# Property and Window Property Segment

```{r, echo=FALSE}
knitr::opts_chunk$set(
  echo    = FALSE,
  warning = FALSE,
  error   = FALSE,
  message = FALSE
)
```

```{r,  results='hide'}
property        <- readRDS("data/nibrs_property_segment_2019.rds")
window_property <- readRDS("data/nibrs_window_recovered_property_segment_2019.rds")
gc()
```

The Property Segment provides a bit more info than would be expected from the name. For each item involved in the crime it tells you what category that items falls into, with 68 total categories (including "other") ranging from explosives and pets to money and alcohol. It also tells you the estimated value of that item. This data covers more than just items stolen during a crime. For each item it tells you what happened to that item such as if it was stolen, damaged, seized by police (such as illegal items like drugs), recovered by police, or burned during an arson.

For drug offenses it includes the drugs seized by police. For these offenses, the data tells us the type of drug, with 16 different drug categories ranging from specific ones like marijuana or heroin to broader categories such as "other narcotics". There can be up to three different drugs included in this data - if the person has more than three types of drugs seized then the third drug category will simply indicate that there are more than three drugs, so we learn what the first two drugs are but not the third or greater drugs are in these cases. For each drug we also know exactly how much was seized with one variable saying the amount the police found and another saying the units we should we reading that amount as (e.g. pills, grams, plants). 

## Important variables

### Description of property

```{r propertyDescription}
temp <- make_frequency_table(property,
                             "property_description",
                             c("Property",
                               "# of Property Stolen",
                               "% of Property Stolen"))
knitr::kable(temp, 
             format = "markdown",
             digits = 2, 
             align = c("l", "r", "r"),
             booktabs = TRUE, 
             longtable = TRUE,
             escape = FALSE,
             caption = "The number and percent of property stolen (including forcibly taken such as during a robbery) in a crime or seized by police (generally in drug arrests) for all offenses in 2019. Each offense can have multiple items stolen/seized.") %>%
  kable_styling(bootstrap_options = "striped", full_width = FALSE, latex_options = c("hold_position", "repeat_header"))
```

\setstretch{1.15}

### Type of property loss

```{r propertyTypeLoss, fig.cap = "The type of loss or if the item is recovered."}
property$type_of_property_loss_temp <- capitalize_words(property$type_of_property_loss)
property$type_of_property_loss_temp <- gsub(" \\(.*", "", property$type_of_property_loss_temp, ignore.case = TRUE)
property$type_of_property_loss_temp[property$type_of_property_loss_temp == "Stolen/Etc."] <- "Stolen/Robbed/Etc."
make_barplots(property, "type_of_property_loss_temp", count = FALSE, ylab = "% of Property")
```


### Value of stolen property

```{r propertyValuePropertyLevel, fig.cap = "The distribution of the value of property stolen. Values are capped at $1,000,000 and each value is rounded to the nearest $100. The x-axis is set on the log scale as this distribution is hugely right skewed."}
temp <-
  property %>%
  filter(type_of_property_loss %in% "stolen/etc. (includes bribed, defrauded, embezzled, extorted, ransomed, robbed, etc.)") %>%
  mutate(value_of_property = parse_number(value_of_property)) %>%
  filter(!is.na(value_of_property))
temp$value_of_property[temp$value_of_property > 1000000] <- 1000000
temp <-
  temp %>%
  mutate(value_of_property_100 = plyr::round_any(value_of_property, 100)) %>%
  group_by(value_of_property_100) %>%
  tally()
temp$proportion <- temp$n / sum(temp$n)
ggplot(temp, aes(x = value_of_property_100, y = proportion)) +
  geom_line(size = 1.02) +
  scale_y_continuous(labels = scales::percent) +
  scale_x_log10(labels = scales::comma) +
  xlab("Property Value") +
  ylab("% of Property") +
  theme_crim()
```



```{r propertyValueIncidentLevel, fig.cap = "The incident-level distribution of the value of property stolen. As values are aggregated to the incident-level, these are higher than the above graph which shows each item individually. Values are capped at $1,000,000 and each value is rounded to the nearest $100. The x-axis is set on the log scale as this distribution is hugely right skewed."}
property$unique_id <- paste(property$ori, property$incident_number)
temp <-
  property %>%
  filter(type_of_property_loss %in% "stolen/etc. (includes bribed, defrauded, embezzled, extorted, ransomed, robbed, etc.)") %>%
  mutate(value_of_property = parse_number(value_of_property)) %>%
  filter(!is.na(value_of_property)) %>%
  dplyr::group_by(unique_id) %>%
  summarize(value_of_property = sum(value_of_property, na.rm = TRUE))
temp$value_of_property[temp$value_of_property > 1000000] <- 1000000
temp <-
  temp %>%
  mutate(value_of_property_100 = plyr::round_any(value_of_property, 100)) %>%
  dplyr::group_by(value_of_property_100) %>%
  tally()
temp$proportion <- temp$n / sum(temp$n)
ggplot(temp, aes(x = value_of_property_100, y = proportion)) +
  geom_line(size = 1.02) +
  scale_y_continuous(labels = scales::percent) +
  scale_x_log10(labels = scales::comma) +
  xlab("Property Value") +
  ylab("% of Property") +
  theme_crim()
```


### Date property was recovered

```{r propertyDaysUntilRecovered, fig.cap = "The distribution of the number of days from the incident to the property recovered date. In 2019 the maximum days from incident to arrest was 450 days. Zero days means that the arrest occurred on the same day as the incident. "}
property$days_until_recovery <- as.numeric(ymd(property$date_recovered) - ymd(property$incident_date))
max_days <- max(property$days_until_recovery, na.rm = TRUE)
temp <- 
  property %>%
  filter(!is.na(date_recovered)) %>%
  mutate(days_until_recovery = as.numeric(days_until_recovery))
temp$days_until_recovery[temp$days_until_recovery %in% 10:30] <- "10-30"
temp$days_until_recovery[temp$days_until_recovery %in% 31:90] <- "31-90"
temp$days_until_recovery[temp$days_until_recovery %in% 91:max_days] <- "91+"
temp <-
  temp %>%
  group_by(days_until_recovery) %>%
  count()

temp$days_until_recovery <- factor(temp$days_until_recovery, 
                                 rev(stringr::str_sort(temp$days_until_recovery, numeric = TRUE)))
temp$proportion <- temp$n / sum(temp$n)
ggplot(temp, aes(x = days_until_recovery, y = proportion)) +
  geom_col() +
  coord_flip() + 
  ggplot2::scale_y_continuous(labels = scales::percent) + 
  xlab("Days Until Recovery") +
  ylab("% of Recoveries") + 
  theme_crim()
```



### Drugs

#### Suspected drug type

```{r propertyDrugs}
temp <- make_frequency_table(property,
                             "suspected_drug_type_1",
                             c("Drug Type",
                               "\\# of Drugs",
                               "\\% of Drugs"))
knitr::kable(temp, 
             format = "markdown",
             digits = 2, 
             align = c("l", "r", "r"),
             booktabs = TRUE, 
             longtable = TRUE,
             escape = FALSE,
             caption = "The number and percent of drugs seized by police by type of drug.") %>%
  kable_styling(bootstrap_options = "striped", full_width = FALSE, latex_options = c("hold_position", "repeat_header"))
```

\setstretch{1.15}

#### Amount of drugs


* Dosage Unit/Items (Pills, Etc.)
* Fluid Ounce
* Gallon                   
* Gram
* Kilogram       
* Liter                   
* Milliliter
* Not Reported
* Number of Plants           
* Ounce
* Pound


```{r propertyAllGramMeasures, fig.cap = "For drugs seized that are measured in grams, this figure shows the distribution in the number of grams seized. Values over 10 grams are grouped together for easier interpretation of lower values of drugs seized."}
temp <-
  property %>%
  filter(!is.na(estimated_quantity_1),
         type_of_measurement_1 %in% "gram") %>%
  mutate(estimated_quantity_1 = parse_number(estimated_quantity_1),
         estimated_quantity_1 = plyr::round_any(estimated_quantity_1, 1)) %>%
  group_by(estimated_quantity_1) %>%
  count() 
temp$estimated_quantity_1[temp$estimated_quantity_1 > 99] <- "101+"
temp$estimated_quantity_1[temp$estimated_quantity_1 %in% 0] <- "<1"
temp$estimated_quantity_1[temp$estimated_quantity_1 %in% 10:25] <- "10-25"
temp$estimated_quantity_1[temp$estimated_quantity_1 %in% 26:50] <- "26-50"
temp$estimated_quantity_1[temp$estimated_quantity_1 %in% 51:100] <- "50-100"

temp$estimated_quantity_1 <- factor(temp$estimated_quantity_1, rev(c("<1", 1:9, "10-25", "26-50", "50-100", "101+")))

temp$proportion <- temp$n / sum(temp$n)
ggplot(temp, aes(x = estimated_quantity_1, y = proportion)) +
  geom_col() +
  coord_flip() + 
  ggplot2::scale_y_continuous(labels = scales::percent) + 
  ylab("% of Drugs") +
  xlab("# of Grams") + 
  theme_crim()

```

